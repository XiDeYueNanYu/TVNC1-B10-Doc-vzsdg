<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习越南语请联系Wx:XiDeYueNanYu</title>
    <style>
        body {
            background-color: #f7fbf3;
            margin-bottom: 60px;
        }
        #infoBox { 
            width: 100%; 
            max-width: 700px;
            height: 100px; 
            margin: 0 auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 60px);
            font-weight: bold;
        }
        #contactBox { 
            width: 100%; 
            max-width: 700px;
            height: 45px; 
            margin: 0px auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(12px, 2vw, 15px); 
            font-weight: bold;
        }
        .image-frame {
            max-width: 700px;
            margin: 20px auto 0 auto;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none;
            overflow: hidden;
        }
        .image-frame img {
            width: 100%;
            height: auto;
            display: block;
        }
        .content-box {
            max-width: 700px;
            margin: 20px auto;
            padding: 50px;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 30px;
            font-family: Arial;
            color: #222322;
            line-height: 3;
            text-align: justify;
        }
        .translated-word {
            position: relative;
            display: inline-block;
            white-space: nowrap;
            line-height: 1.3;
            background-color: #bfcdbf;
            color: #000000;
            padding: 4px 4px;
            border-radius: 2px;
        }
        .translation {
            position: absolute;
            top: -29px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            background-color: #eddabc;
            color: #313a2d;
            padding: 4px 4px;
            border-radius: 1px;
            white-space: nowrap;
            z-index: 1;
            line-height: 1;
        }
        .original {
            display: inline;
            line-height: 1;
        }
        .floating-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-align: center;
            display: block;
            z-index: 1000;
        }
        #audioPlayer {
            width: 100%;
            margin-bottom: 10px;
        }
        .time-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .time-box-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .floating-controls p#timeDisplay {
            font-size: 28px;
            color: #FFFFFF;
            background-color: #000000;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0;
        }
        .floating-controls .time-box {
            font-size: 16px;
            color: #FFFFFF;
            background-color: #555555;
            padding: 5px 10px;
            border-radius: 5px;
            min-width: 60px;
        }
        .tua-buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .control-button {
            width: 50px;
            height: 50px;
            background-color: #363535;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }
        .control-button:disabled {
            background-color: #888888;
            cursor: not-allowed;
        }
        .control-button:hover:not(:disabled) {
            background-color: #000000;
        }
        .pause-play-button {
            background-color: #FF4500;
        }
        .pause-play-button:hover {
            background-color: #CC3700;
        }
        .toggle-button {
            background-color: #4682B4;
        }
        .toggle-button:hover {
            background-color: #36648B;
        }
        .loop-button {
            background-color: #3c923c;
        }
        .loop-button:hover {
            background-color: #347d34;
        }
        .clear-button {
            background-color: #bc3f13;
        }
        .clear-button:hover {
            background-color: #d15124;
        }
        .active {
            background-color: #ffffff; 
            border-radius: 5px;
        }
        #quizContainer {
            display: none;
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            color: #53686f;
            font-size: 25px;
            font-weight: bold;
        }
        .question {
            margin-bottom: 20px;
            padding: 18px;
            color: #53686f;
            border: 5px solid #53686f;
            border-radius: 10px;
            background-color: #ffffff;
            font-size: 20px;
            font-weight: bold;
        }
        .options label {
            display: block;
            margin: 15px 0;
            cursor: pointer;
            color: #21292c;
            font-size: 16px;
            font-weight: bold;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            display: none;
            border: 5px solid #53686f;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            background-color: #ffffff;
            color: #007a33;
        }
        .wrong-answer {
            color: #f65936;
            margin: 10px 0;
            font-size: 16px;
            font-weight: bold;
        }
        #submitQuiz {
            font-family: Arial, sans-serif;
            padding: 10px 20px;
            border: 3px solid #53686f;
            background-color: #FF6820;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        #submitQuiz:hover {
            background-color: #ff844a;
        }
        #vocabContainer {
            display: none;
            max-width: 700px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #vocabControls {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 900px;
            background: #68838B;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            margin-bottom: 10px;
        }
        #vocabControls div {
            margin: 5px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #vocabControls button {
            padding: 8px 8px;
            margin: 0 5px;
            cursor: pointer;
            border: 3px solid #5d757d;
            background: #0f1314;
            color: #fffbef;
            font-size: 28px;
            border-radius: 5px;
        }
        #sentenceNumber {
            width: 50px;
            padding: 10px;
            text-align: center;
            border: 3px solid #68838B;
            background: #FFAD5B;
            color: #000;
            border-radius: 10px;
            font-size: 16px;
            -moz-appearance: textfield;
        }
        #sentenceNumber::-webkit-inner-spin-button, 
        #sentenceNumber::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        #sentenceNumber:disabled {
            background: #eee;
        }
        .disabled {
            cursor: not-allowed;
            pointer-events: none;
        }
        .active-mode {
            border: 4px solid orange;
        }
        #vocabIndicator {
            width: 95%;
            max-width: 700px;
            min-height: 50px;
            margin: 10px auto;
            padding: 5px;
            border: 3px solid #734A2E;
            background: #ffffe0;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #vocabOptionsContainer {
            width: 100%;
            max-width: 700px;
            margin: 10px auto;
        }
        .optionBtn {
            width: 95%;
            max-width: 700px;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #734A2E;
            background: #ffffff;
            color: #000;
            font-size: 30px;
            text-align: left;
            cursor: pointer;
            border-radius: 5px;
        }
        .optionBtn:hover {
            background: #D2E4C4;
        }
        .correct {
            background: #B7D7AA !important;
        }
        .wrong {
            background: #CE6D5E !important;
        }
        .floating-mode-bar {
            position: fixed;
            bottom: 0px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #68838B;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0px 5px rgba(0, 0, 0, 1);
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 1000;
            width: 900px;
        }
        .mode-button {
            padding: 10px 20px;
            border: 0px solid #ccc;
            background: #95a8ad;
            color: #293437;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: border-color 0.3s;
        }
        .mode-button.active {
            border: 2px solid #ffffff;
            background: #f0f0f0;
            color: #293437;
        }
        @media (max-width: 768px) { 
            body {
                margin-bottom: 200px;
            }
            #infoBox { 
                width: 90%; 
                height: 120px; 
                font-size: clamp(30px, 4vw, 40px);
            }
            #contactBox { 
                width: 90%; 
                height: 50px; 
                font-size: clamp(14px, 2vw, 16px);
            }
            .image-frame {
                width: 90%;
                margin: 10px auto 0 auto;
            }
            .content-box {
                margin: 10px auto;
                padding: 20px;
                padding-top: 50px;
                padding-bottom: 90px;
                font-size: 19px;
                line-height: 3.5;
            }
            .translated-word {
                padding: 3px 3px;
            }
            .translation {
                top: -25px;
                font-size: 13px;
            }
            .floating-controls {
                top: 10px;
                right: 10px;
                padding: 5px;
            }
            #vocabControls {
                width: 100%;
                bottom: 50px;
                padding: 5px 0;
            }
            #vocabControls button {
                padding: 6px 6px;
                font-size: 20px;
            }
            #sentenceNumber {
                width: 40px;
                padding: 8px;
                font-size: 14px;
            }
            #vocabIndicator {
                min-height: 40px;
            }
            .optionBtn {
                font-size: 20px;
                padding: 8px;
            }
            .floating-mode-bar {
                width: 100%;
            }
        }
        @media (max-width: 400px) {
            .control-button {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            .floating-controls p#timeDisplay {
                font-size: 20px;
            }
            .floating-controls .time-box {
                font-size: 12px;
                min-width: 50px;
            }
        }
    </style>
</head>
<body>
    <div id="infoBox">习得越南语</div>
    <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
    <div id="contentContainer">
        <div class="image-frame" id="imageFrame">
            <img id="contentImage" src="anhminhhoa.jpg" alt="Content Image">
        </div>
        <div class="content-box" id="content"></div>
    </div>
    <div id="quizContainer">
        <h1>回答下面问题</h1>
        <form id="quizForm">
            <div id="questions"></div>
            <button type="button" id="submitQuiz" onclick="checkAnswers()">提交</button>
        </form>
        <div id="result"></div>
    </div>
    <div id="vocabContainer">
        <div id="vocabIndicator"></div>
        <div id="vocabOptionsContainer"></div>
    </div>
    <div class="floating-controls" id="floatingControls">
        <audio id="audioPlayer" src="lesson.mp3" controls></audio>
        <div class="time-row">
            <p id="timeDisplay">00:00</p>
            <div class="time-box-group">
                <span class="time-box" id="loopStart">--:--</span>
                <span class="time-box" id="loopEnd">--:--</span>
            </div>
            <div class="button-group">
                <button class="control-button loop-button" id="loopButton">听</button>
                <button class="control-button clear-button" id="clearButton">删</button>
            </div>
        </div>
        <div class="tua-buttons">
            <button class="control-button" id="rewind5sButton">-5s</button>
            <button class="control-button" id="rewind1sButton">-1s</button>
            <button class="control-button" id="forward1sButton">+1s</button>
            <button class="control-button" id="forward5sButton">+5s</button>
        </div>
        <div class="action-buttons">
            <button class="control-button pause-play-button" id="pausePlayButton">播</button>
            <button class="control-button toggle-button" id="toggleControlsButton">藏</button>
        </div>
    </div>
    <div id="vocabControls">
        <div>
            <button id="prevBtn">◀</button>
            <input type="text" id="sentenceNumber" inputmode="numeric" pattern="[0-9]*">
            <button id="nextBtn">▶</button>
        </div>
        <div>
            <button id="showHideBtn" class="active-mode">显示-隐藏</button>
            <button id="replayBtn">再听一遍</button>
        </div>
    </div>
    <div class="floating-mode-bar">
        <button class="mode-button active" id="contentMode">内容</button>
        <button class="mode-button" id="quizMode">回答问题</button>
        <button class="mode-button" id="vocabMode">词汇</button>
    </div>

    <audio id="vocabAudio" src="audio.mp3"></audio>
    <audio id="correctAudio" src="Dung.mp3"></audio>
    <audio id="wrongAudio" src="Sai.mp3"></audio>

    <script>

const textContentData = [
    `NHỮNG NGÀY Ở VIỆT NAM CỦA LINDA
Linda mới đến Hà Nội vài tuần, nhưng đã có khá nhiều bạn. Một số là bạn Việt Nam, một số là bạn người nước ngoài. Linda là người nhanh nhẹn, hoạt bát, dễ gần, nên rất dễ kết bạn.
Ở Hà Nội, Linda đi suốt ngày, không mấy khi ở nhà. Ngoài việc học tiếng Việt, Linda còn đi tìm hiểu nhiều di tích cổ ở các vùng lân cận. Mỗi lần ra ngoài Hà Nội, Linda lại hiểu thêm về cuộc sống của người dân nông thôn. Bạn bè giúp đỡ Linda rất nhiều.
Bây giờ, vốn tiếng Việt của Linda khá phong phú. Mỗi ngày, Linda học thêm được dăm bảy từ. Cô ấy nghe và nói tiếng Việt rất tốt. Vì thường xuyên đi chơi với bạn Việt Nam, nên Linda còn biết thêm cả một số tiếng lóng mà lớp trẻ thường dùng.
Linda tiến bộ nhanh về tiếng Việt là nhờ hàng ngày cô ấy luôn nói chuyện và trao đổi với các bạn Việt Nam. Thỉnh thoảng, Linda đến nhà các bạn chơi để biết thêm về sinh hoạt của các gia đình.
Linda nghĩ rằng không mấy khi mình có dịp đi Việt Nam như thế này, nên phải cố gắng tận dụng cơ hội để học hỏi. Cô ấy thường nói:
“Tiếng Việt của mình khá lên và mình có được nhiều kinh nghiệm hơn là nhờ các bạn của mình. Mình luôn biết ơn tất cả các bạn.”`
];
const dictionary = {
    "ngày": "天",
    "Việt Nam": "越南",
    "Linda": "琳达",
    "Hà Nội": "河内",
    "tuần": "周",
    "bạn": "朋友",
    "người nước ngoài": "外国人",
    "nhanh nhẹn": "敏捷",
    "hoạt bát": "活泼",
    "dễ gần": "平易近人",
    "kết bạn": "交朋友",
    "đi": "去",
    "nhà": "家",
    "học": "学习",
    "tiếng Việt": "越南语",
    "tìm hiểu": "了解",
    "di tích cổ": "古迹",
    "vùng lân cận": "周边地区",
    "cuộc sống": "生活",
    "người dân": "人民",
    "nông thôn": "农村",
    "giúp đỡ": "帮助",
    "vốn": "词汇量",
    "phong phú": "丰富",
    "từ": "单词",
    "nghe": "听",
    "nói": "说",
    "tốt": "好",
    "thường xuyên": "经常",
    "chơi": "玩",
    "tiếng lóng": "俚语",
    "lớp trẻ": "年轻人",
    "tiến bộ": "进步",
    "nhanh": "快",
    "nhờ": "多亏",
    "nói chuyện": "聊天",
    "trao đổi": "交流",
    "thỉnh thoảng": "偶尔",
    "sinh hoạt": "生活",
    "gia đình": "家庭",
    "nghĩ": "想",
    "dịp": "机会",
    "cố gắng": "努力",
    "tận dụng": "利用",
    "cơ hội": "机会",
    "học hỏi": "学习",
    "khá lên": "进步",
    "kinh nghiệm": "经验",
    "biết ơn": "感激",
    "tất cả": "所有"
};
const quizData = [
    {
        question: "Theo bài đọc, điều gì giúp Linda nhanh chóng làm quen được với nhiều người bạn?",
        options: ["Cô ấy nói tiếng Việt rất giỏi từ trước", "Cô ấy học cùng lớp với nhiều người", "Tính cách nhanh nhẹn, hoạt bát, dễ gần", "Bạn bè người nước ngoài giới thiệu"],
        correct: "Tính cách nhanh nhẹn, hoạt bát, dễ gần"
    },
    {
        question: "Vì sao Linda tiến bộ nhanh trong việc học tiếng Việt?",
        options: ["Vì cô ấy có giáo viên dạy kèm riêng", "Vì cô ấy thường xuyên luyện nói với bạn bè Việt Nam", "Vì cô ấy chỉ học lý thuyết và từ vựng", "Vì cô ấy không sử dụng tiếng Anh khi giao tiếp"],
        correct: "Vì cô ấy thường xuyên luyện nói với bạn bè Việt Nam"
    },
    {
        question: "Điều gì cho thấy Linda có thái độ tích cực trong việc học tập?",
        options: ["Cô ấy luôn ghi chép bài đầy đủ", "Cô ấy đặt mục tiêu cao trong học tập", "Cô ấy tận dụng mọi cơ hội để học hỏi", "Cô ấy dành thời gian tự học nhiều hơn trên lớp"],
        correct: "Cô ấy tận dụng mọi cơ hội để học hỏi"
    },
    {
        question: "Câu “Linda là người nhanh nhẹn, hoạt bát, dễ gần” cho thấy tác giả có thái độ thế nào đối với Linda?",
        options: ["Cảnh giác", "Ngưỡng mộ", "Trung lập", "Thiếu tin tưởng"],
        correct: "Ngưỡng mộ"
    },
    {
        question: "Theo bài, Linda biết thêm tiếng lóng là nhờ đâu?",
        options: ["Nhờ học qua Internet", "Nhờ giáo viên dạy riêng", "Nhờ đọc sách và báo tiếng Việt", "Nhờ đi chơi nhiều với bạn Việt Nam"],
        correct: "Nhờ đi chơi nhiều với bạn Việt Nam"
    },
    {
        question: "Có thể suy ra vì sao Linda thích đi thăm các vùng lân cận Hà Nội?",
        options: ["Vì muốn tìm nơi yên tĩnh để học", "Vì tò mò muốn hiểu thêm về đời sống nông thôn Việt Nam", "Vì không thích ở Hà Nội lâu", "Vì ở đó có nhiều người nước ngoài"],
        correct: "Vì tò mò muốn hiểu thêm về đời sống nông thôn Việt Nam"
    },
    {
        question: "Theo bài, Linda đến nhà bạn Việt Nam để làm gì?",
        options: ["Để dạy tiếng Anh cho các bạn", "Để tham gia các buổi tiệc", "Để hiểu thêm sinh hoạt gia đình Việt Nam", "Để chơi game với bạn bè"],
        correct: "Để hiểu thêm sinh hoạt gia đình Việt Nam"
    },
    {
        question: "Linda học thêm được dăm bảy từ mỗi ngày chứng tỏ điều gì?",
        options: ["Cô ấy học theo chương trình học chính quy", "Cô ấy chủ yếu học qua phim ảnh", "Cô ấy có tốc độ học đều đặn và hiệu quả", "Cô ấy học thuộc lòng rất nhanh"],
        correct: "Cô ấy có tốc độ học đều đặn và hiệu quả"
    },
    {
        question: "Thái độ của Linda đối với bạn bè được thể hiện rõ nhất qua câu nào?",
        options: ["“Cô ấy thường xuyên đi chơi với bạn Việt Nam”", "“Cô ấy nghĩ rằng không mấy khi có dịp đi Việt Nam”", "“Mình luôn biết ơn tất cả các bạn”", "“Mỗi lần ra ngoài Hà Nội, Linda lại hiểu thêm về cuộc sống”"],
        correct: "“Mình luôn biết ơn tất cả các bạn”"
    },
    {
        question: "Theo bài, lý do nào giúp vốn tiếng Việt của Linda trở nên phong phú?",
        options: ["Cô ấy học qua sách giáo khoa", "Cô ấy tham gia các lớp học ngữ pháp", "Cô ấy học từ bạn bè và trải nghiệm thực tế", "Cô ấy học mỗi tuần một lần"],
        correct: "Cô ấy học từ bạn bè và trải nghiệm thực tế"
    },
    {
        question: "Linda cho rằng cơ hội đến Việt Nam là gì?",
        options: ["Một trải nghiệm học thuật ngắn hạn", "Cơ hội để học hỏi và tích lũy kinh nghiệm", "Một chuyến du lịch giải trí dài ngày", "Cơ hội để nghiên cứu về văn hóa truyền thống"],
        correct: "Cơ hội để học hỏi và tích lũy kinh nghiệm"
    },
    {
        question: "Mục đích chính của bài viết là gì?",
        options: ["Miêu tả một chuyến đi của Linda đến các vùng nông thôn", "Phân tích sự khác biệt văn hóa giữa Việt Nam và phương Tây", "Kể về quá trình thích nghi và học tiếng Việt của Linda qua giao tiếp thực tế", "Giới thiệu các di tích cổ ở Hà Nội mà Linda đã tham quan"],
        correct: "Kể về quá trình thích nghi và học tiếng Việt của Linda qua giao tiếp thực tế"
    }
];
const sentences = [
    {
        "audioFile": "audio.mp3",
        "start": 0.131111,
        "end": 1.181111,
        "correctAnswer": "nhanh nhẹn",
        "translation": "敏捷",
        "options": [
            "nhanh nhẹn",
            "nhanh nhện",
            "nhạnh nhẹn",
            "nhanh nhận"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 1.301111,
        "end": 2.241111,
        "correctAnswer": "hoạt bát",
        "translation": "活泼",
        "options": [
            "hoạt bát",
            "hoạc bát",
            "hoạch bát",
            "hoạt bác"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 2.441111,
        "end": 3.461111,
        "correctAnswer": "dễ gần",
        "translation": "平易近人",
        "options": [
            "dễ gần",
            "dễ gẩn",
            "dẽ gần",
            "dễ gàn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 3.651111,
        "end": 4.601111,
        "correctAnswer": "kết bạn",
        "translation": "交朋友",
        "options": [
            "kết bạn",
            "két bạn",
            "kết bãn",
            "kết bạt"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 4.801111,
        "end": 5.851111,
        "correctAnswer": "tìm hiểu",
        "translation": "了解",
        "options": [
            "tìm hiểu",
            "tim hiểu",
            "tìm hiễu",
            "tìm hểu"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 6.001111,
        "end": 7.271111,
        "correctAnswer": "di tích cổ",
        "translation": "古迹",
        "options": [
            "di tích cổ",
            "zi tích cổ",
            "di tịch cổ",
            "di tích cỗ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 7.481111,
        "end": 8.611111,
        "correctAnswer": "vùng lân cận",
        "translation": "周边地区",
        "options": [
            "vùng lân cận",
            "vung lân cận",
            "vùng lâm cận",
            "vùng lân cẫn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 8.791111,
        "end": 9.891111,
        "correctAnswer": "nông thôn",
        "translation": "农村",
        "options": [
            "nông thôn",
            "nôm thôn",
            "nông thônn",
            "nông thôm"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 10.031111,
        "end": 11.081111,
        "correctAnswer": "giúp đỡ",
        "translation": "帮助",
        "options": [
            "giúp đỡ",
            "giụp đỡ",
            "giúp dỡ",
            "giúp đở"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 11.311111,
        "end": 12.341111,
        "correctAnswer": "phong phú",
        "translation": "丰富",
        "options": [
            "phong phú",
            "phông phú",
            "phong phụ",
            "phong phũ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 12.601111,
        "end": 13.351111,
        "correctAnswer": "từ",
        "translation": "单词",
        "options": [
            "từ",
            "tứ",
            "tử",
            "tư"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 13.731111,
        "end": 14.711111,
        "correctAnswer": "tiếng lóng",
        "translation": "俚语",
        "options": [
            "tiếng lóng",
            "tiếng long",
            "tiếng lõng",
            "tiêng lóng"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 15.041111,
        "end": 16.061111,
        "correctAnswer": "lớp trẻ",
        "translation": "年轻人",
        "options": [
            "lớp trẻ",
            "lớp trẽ",
            "lớp chẻ",
            "lốp trẻ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 16.341111,
        "end": 17.291111,
        "correctAnswer": "tiến bộ",
        "translation": "进步",
        "options": [
            "tiến bộ",
            "tiến bọ",
            "tiên bọ",
            "tiến bồ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 17.521111,
        "end": 18.391111,
        "correctAnswer": "nhờ",
        "translation": "多亏",
        "options": [
            "nhờ",
            "nhời",
            "nhở",
            "nhơi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 18.561111,
        "end": 19.641111,
        "correctAnswer": "nói chuyện",
        "translation": "聊天",
        "options": [
            "nói chuyện",
            "nối chuyện",
            "nói chuyền",
            "nói chụyện"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 19.891111,
        "end": 20.841111,
        "correctAnswer": "trao đổi",
        "translation": "交流",
        "options": [
            "trao đổi",
            "chao đổi",
            "trao đỏi",
            "trao dổi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 21.191111,
        "end": 22.191111,
        "correctAnswer": "thỉnh thoảng",
        "translation": "偶尔",
        "options": [
            "thỉnh thoảng",
            "thỉnh thoạng",
            "thỉnh thoảngg",
            "thịnh thoảng"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 22.431111,
        "end": 23.491111,
        "correctAnswer": "sinh hoạt",
        "translation": "生活",
        "options": [
            "sinh hoạt",
            "xinh hoạt",
            "sinh hoat",
            "sinh huật"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 23.861111,
        "end": 24.841111,
        "correctAnswer": "gia đình",
        "translation": "家庭",
        "options": [
            "gia đình",
            "gia đinh",
            "gia đìng",
            "da đình"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 25.121111,
        "end": 25.801111,
        "correctAnswer": "dịp",
        "translation": "机会",
        "options": [
            "dịp",
            "dẹp",
            "dịph",
            "dỵp"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 26.261111,
        "end": 27.241111,
        "correctAnswer": "cố gắng",
        "translation": "努力",
        "options": [
            "cố gắng",
            "cổ gắng",
            "cố gẵng",
            "cố gáng"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 27.521111,
        "end": 28.491111,
        "correctAnswer": "tận dụng",
        "translation": "利用",
        "options": [
            "tận dụng",
            "tẫn dụng",
            "tận dung",
            "tận dùng"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 28.891111,
        "end": 29.851111,
        "correctAnswer": "học hỏi",
        "translation": "学习",
        "options": [
            "học hỏi",
            "hộc hỏi",
            "học hỏii",
            "học hõi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 30.311111,
        "end": 31.271111,
        "correctAnswer": "khá lên",
        "translation": "进步",
        "options": [
            "khá lên",
            "khà lên",
            "khá lến",
            "khá len"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 31.601111,
        "end": 32.531111,
        "correctAnswer": "kinh nghiệm",
        "translation": "经验",
        "options": [
            "kinh nghiệm",
            "kinh nghệm",
            "kinh nghiêm",
            "kinh nguyện"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 32.781111,
        "end": 33.781111,
        "correctAnswer": "biết ơn",
        "translation": "感激",
        "options": [
            "biết ơn",
            "biêt ơn",
            "biếc ơn",
            "biết ơnn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 33.981111,
        "end": 34.871111,
        "correctAnswer": "tất cả",
        "translation": "所有",
        "options": [
            "tất cả",
            "tất cá",
            "tắt cả",
            "tất cã"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 35.241111,
        "end": 36.181111,
        "correctAnswer": "dễ gần",
        "translation": "平易近人",
        "options": [
            "dễ gần",
            "dế gần",
            "dễ gân",
            "dễ gàn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 36.531111,
        "end": 37.511111,
        "correctAnswer": "thường xuyên",
        "translation": "经常",
        "options": [
            "thường xuyên",
            "thương xuyên",
            "thường xuyền",
            "thường xuyến"
        ]
    }
];

        // Xử lý hiển thị văn bản với từ điển
        const content = document.getElementById('content');
        function renderText() {
            let html = textContentData[0].replace(/\n/g, "<br>");
            const sortedKeys = Object.keys(dictionary).sort((a, b) => b.length - a.length);
            const replacements = [];

            sortedKeys.forEach(key => {
                const regex = new RegExp(`(\\b|[.,!?\\n\\s]|^)(${key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})(\\b|[.,!?\\n\\s]|$)`, 'gi');
                let match;
                while ((match = regex.exec(html)) !== null) {
                    const start = match.index + match[1].length;
                    const end = start + match[2].length;
                    replacements.push({
                        start,
                        end,
                        original: match[2],
                        prefix: match[1],
                        suffix: match[3],
                        translation: dictionary[key]
                    });
                }
            });

            replacements.sort((a, b) => a.start - b.start);
            const filteredReplacements = [];
            let lastEnd = -1;
            for (const replacement of replacements) {
                if (replacement.start >= lastEnd) {
                    filteredReplacements.push(replacement);
                    lastEnd = replacement.end;
                }
            }

            for (let i = filteredReplacements.length - 1; i >= 0; i--) {
                const { start, end, original, prefix, suffix, translation } = filteredReplacements[i];
                const translatedHtml = `${prefix}<span class="translated-word"><span class="translation">${translation}</span><span class="original">${original}</span></span>${suffix}`;
                html = html.slice(0, start - prefix.length) + translatedHtml + html.slice(end + suffix.length);
            }

            content.innerHTML = html;
        }

        // Xử lý hiển thị ảnh
        const imageFrame = document.getElementById('imageFrame');
        const contentImage = document.getElementById('contentImage');
        const imageSrc = "anhminhhoa.jpg";
        function renderImage() {
            if (imageSrc) {
                contentImage.src = imageSrc;
                imageFrame.style.display = 'block';
            } else {
                imageFrame.style.display = 'none';
            }
        }

        // Xử lý audio và bảng điều khiển
        const audioPlayer = document.getElementById("audioPlayer");
        const floatingControls = document.getElementById("floatingControls");
        if (!floatingControls) {
            console.error('Không tìm thấy floatingControls');
        }
        const timeDisplay = floatingControls ? floatingControls.querySelector("#timeDisplay") : null;
        const loopStart = floatingControls ? floatingControls.querySelector("#loopStart") : null;
        const loopEnd = floatingControls ? floatingControls.querySelector("#loopEnd") : null;
        const loopButton = floatingControls ? floatingControls.querySelector("#loopButton") : null;
        const clearButton = floatingControls ? floatingControls.querySelector("#clearButton") : null;
        const rewind5sButton = floatingControls ? floatingControls.querySelector("#rewind5sButton") : null;
        const rewind1sButton = floatingControls ? floatingControls.querySelector("#rewind1sButton") : null;
        const forward1sButton = floatingControls ? floatingControls.querySelector("#forward1sButton") : null;
        const forward5sButton = floatingControls ? floatingControls.querySelector("#forward5sButton") : null;
        const pausePlayButton = floatingControls ? floatingControls.querySelector("#pausePlayButton") : null;
        const toggleControlsButton = floatingControls ? floatingControls.querySelector("#toggleControlsButton") : null;
        const tuaButtons = floatingControls ? floatingControls.querySelector(".tua-buttons") : null;

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay(displayElement) {
            if (displayElement) {
                displayElement.textContent = formatTime(audioPlayer.currentTime);
            }
        }

        let customLoopStart = null;
        let customLoopEnd = null;
        let clickCount = 0;
        let isLooping = false;

        if (timeDisplay) {
            const updateInterval = setInterval(() => updateTimeDisplay(timeDisplay), 1000);
            timeDisplay.onclick = () => {
                if (audioPlayer.paused) {
                    clickCount++;
                    if (clickCount === 1) {
                        customLoopStart = audioPlayer.currentTime;
                        loopStart.textContent = formatTime(customLoopStart);
                    } else if (clickCount === 2) {
                        customLoopEnd = audioPlayer.currentTime;
                        if (customLoopEnd <= customLoopStart) {
                            customLoopEnd = null;
                            loopEnd.textContent = "--:--";
                        } else {
                            loopEnd.textContent = formatTime(customLoopEnd);
                        }
                        clickCount = 0;
                    }
                }
            };
        }

        if (audioPlayer) {
            audioPlayer.ontimeupdate = function() {
                updateTimeDisplay(timeDisplay);
                if (isLooping && customLoopStart !== null && customLoopEnd !== null) {
                    if (audioPlayer.currentTime >= customLoopEnd) {
                        audioPlayer.currentTime = customLoopStart;
                    }
                }
            };
        }

        if (rewind5sButton) {
            rewind5sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 5);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (rewind1sButton) {
            rewind1sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 1);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (forward1sButton) {
            forward1sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 1);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (forward5sButton) {
            forward5sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 5);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }

        if (pausePlayButton) {
            pausePlayButton.onclick = () => {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    pausePlayButton.textContent = "停";
                } else {
                    audioPlayer.pause();
                    pausePlayButton.textContent = "播";
                }
            };
        }

        if (loopButton) {
            loopButton.onclick = () => {
                if (customLoopStart !== null && customLoopEnd !== null) {
                    audioPlayer.currentTime = customLoopStart;
                    audioPlayer.play();
                    isLooping = true;
                    if (rewind5sButton) rewind5sButton.disabled = true;
                    if (rewind1sButton) rewind1sButton.disabled = true;
                    if (forward1sButton) forward1sButton.disabled = true;
                    if (forward5sButton) forward5sButton.disabled = true;
                }
            };
        }

        if (clearButton) {
            clearButton.onclick = () => {
                customLoopStart = null;
                customLoopEnd = null;
                if (loopStart) loopStart.textContent = "--:--";
                if (loopEnd) loopEnd.textContent = "--:--";
                clickCount = 0;
                isLooping = false;
                if (rewind5sButton) rewind5sButton.disabled = false;
                if (rewind1sButton) rewind1sButton.disabled = false;
                if (forward1sButton) forward1sButton.disabled = false;
                if (forward5sButton) forward5sButton.disabled = false;
            };
        }

        let controlsVisible = true;
        if (toggleControlsButton) {
            toggleControlsButton.onclick = () => {
                if (controlsVisible) {
                    if (timeDisplay) timeDisplay.style.display = "none";
                    if (tuaButtons) tuaButtons.style.display = "none";
                    if (pausePlayButton) pausePlayButton.style.display = "none";
                    if (loopStart) loopStart.style.display = "none";
                    if (loopEnd) loopEnd.style.display = "none";
                    if (loopButton) loopButton.style.display = "none";
                    if (clearButton) clearButton.style.display = "none";
                    toggleControlsButton.textContent = "示";
                    controlsVisible = false;
                } else {
                    if (timeDisplay) timeDisplay.style.display = "inline-block";
                    if (tuaButtons) tuaButtons.style.display = "flex";
                    if (pausePlayButton) pausePlayButton.style.display = "inline-flex";
                    if (loopStart) loopStart.style.display = "inline-block";
                    if (loopEnd) loopEnd.style.display = "inline-block";
                    if (loopButton) loopButton.style.display = "inline-flex";
                    if (clearButton) clearButton.style.display = "inline-flex";
                    toggleControlsButton.textContent = "藏";
                    controlsVisible = true;
                }
            };
        }

        if (audioPlayer) {
            audioPlayer.onpause = audioPlayer.onended = function() {
                if (pausePlayButton) pausePlayButton.textContent = "播";
            };
        }

        // Xử lý chế độ từ vựng
        const vocabAudio = document.getElementById('vocabAudio');
        const correctAudio = document.getElementById('correctAudio');
        const wrongAudio = document.getElementById('wrongAudio');
        const vocabIndicator = document.getElementById('vocabIndicator');
        const sentenceNumber = document.getElementById('sentenceNumber');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const replayBtn = document.getElementById('replayBtn');
        const showHideBtn = document.getElementById('showHideBtn');
        const vocabOptionsContainer = document.getElementById('vocabOptionsContainer');

        let currentIndex = 0;
        let showAnswer = true;
        let isPlaying = false;

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function updateVocabDisplay() {
            if (sentenceNumber) sentenceNumber.value = currentIndex + 1;
            if (vocabIndicator) {
                vocabIndicator.style.background = '#ffffe0';
                vocabIndicator.innerHTML = showAnswer ? `
                    <div style="font-size: 20px; font-weight: normal; color: #38761d;">${sentences[currentIndex].translation}</div>
                ` : '';
            }
            updateVocabOptions();
            playCurrentSentence();
        }

        function updateVocabOptions() {
            if (vocabOptionsContainer) {
                vocabOptionsContainer.innerHTML = '';
                const shuffledOptions = shuffleArray(sentences[currentIndex].options);
                shuffledOptions.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'optionBtn';
                    btn.textContent = option;
                    btn.onclick = () => checkVocabAnswer(option);
                    vocabOptionsContainer.appendChild(btn);
                });
            }
        }

        function playCurrentSentence() {
            if (isPlaying) vocabAudio.pause();
            [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.add('disabled'));
            if (sentenceNumber) sentenceNumber.disabled = true;
            isPlaying = true;
            vocabAudio.src = sentences[currentIndex].audioFile;
            vocabAudio.currentTime = sentences[currentIndex].start;
            vocabAudio.play().catch(error => {
                console.error('Audio playback failed:', error);
                alert('Vui lòng nhấn nút “再听一遍” để phát âm thanh.');
                [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.remove('disabled'));
                if (sentenceNumber) sentenceNumber.disabled = false;
                isPlaying = false;
            });

            vocabAudio.ontimeupdate = () => {
                if (vocabAudio.currentTime >= sentences[currentIndex].end) {
                    vocabAudio.pause();
                    vocabAudio.ontimeupdate = null;
                    [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.remove('disabled'));
                    if (sentenceNumber) sentenceNumber.disabled = false;
                    isPlaying = false;
                }
            };
        }

        function moveSentence(direction) {
            currentIndex = (currentIndex + direction + sentences.length) % sentences.length;
            updateVocabDisplay();
        }

        function checkVocabAnswer(selectedAnswer) {
            const correctAnswer = sentences[currentIndex].correctAnswer;
            const optionButtons = vocabOptionsContainer.getElementsByClassName('optionBtn');

            for (let btn of optionButtons) {
                btn.classList.remove('correct', 'wrong');
                if (btn.textContent === selectedAnswer) {
                    if (selectedAnswer === correctAnswer) {
                        vocabIndicator.style.background = '#B7D7AA';
                        btn.classList.add('correct');
                        correctAudio.play().catch(error => console.error('Correct audio playback failed:', error));
                        correctAudio.onended = () => {
                            setTimeout(() => moveSentence(1), 200);
                        };
                    } else {
                        vocabIndicator.style.background = '#CE6D5E';
                        btn.classList.add('wrong');
                        wrongAudio.play().catch(error => console.error('Wrong audio playback failed:', error));
                        wrongAudio.onended = null;
                    }
                }
            }
        }

        if (prevBtn) {
            prevBtn.onclick = () => {
                if (!isPlaying) moveSentence(-1);
            };
        }

        if (nextBtn) {
            nextBtn.onclick = () => {
                if (!isPlaying) moveSentence(1);
            };
        }

        if (replayBtn) {
            replayBtn.onclick = () => {
                if (!isPlaying) playCurrentSentence();
            };
        }

        if (showHideBtn) {
            showHideBtn.onclick = () => {
                if (!isPlaying) {
                    showAnswer = !showAnswer;
                    showHideBtn.classList.toggle('active-mode');
                    updateVocabDisplay();
                }
            };
        }

        if (sentenceNumber) {
            sentenceNumber.onchange = () => {
                if (!isPlaying) {
                    const num = parseInt(sentenceNumber.value) - 1;
                    if (!isNaN(num) && num >= 0 && num < sentences.length) {
                        currentIndex = num;
                        updateVocabDisplay();
                    } else {
                        alert(`输入范围： 1 到 ${sentences.length}`);
                        updateVocabDisplay();
                    }
                }
            };

            sentenceNumber.onkeydown = (e) => {
                if (!isPlaying) {
                    if (e.key === 'ArrowLeft') moveSentence(-1);
                    if (e.key === 'ArrowRight') moveSentence(1);
                }
            };
        }

        function initVocab() {
            currentIndex = 0;
            showAnswer = true;
            isPlaying = false;
            updateVocabDisplay();
        }

        // Xử lý câu hỏi
        let contentScrollPosition = 0;
        let quizScrollPosition = 0;
        let vocabScrollPosition = 0;
        let userSelections = {};
        let isSubmitted = false;

        function loadQuiz() {
            const questionsDiv = document.getElementById('questions');
            if (questionsDiv) {
                questionsDiv.innerHTML = '';
                quizData.forEach((item, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question';
                    const questionTitle = document.createElement('h3');
                    questionTitle.textContent = `Câu ${index + 1}: ${item.question}`;
                    questionDiv.appendChild(questionTitle);

                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'options';
                    item.options.forEach(option => {
                        const label = document.createElement('label');
                        const isChecked = userSelections[`question${index}`] === option ? 'checked' : '';
                        label.innerHTML = `
                            <input type="radio" name="question${index}" value="${option}" ${isChecked}>
                            ${option}
                        `;
                        optionsDiv.appendChild(label);
                    });

                    questionDiv.appendChild(optionsDiv);
                    questionsDiv.appendChild(questionDiv);
                });
                window.scrollTo(0, quizScrollPosition);
            }
        }

        function saveSelections() {
            quizData.forEach((_, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    userSelections[`question${index}`] = selected.value;
                }
            });
        }

        function checkAnswers() {
            let score = 0;
            const total = quizData.length;
            let wrongAnswers = [];
            quizData.forEach((item, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    if (selected.value === item.correct) {
                        score++;
                    } else {
                        wrongAnswers.push({
                            question: item.question,
                            selected: selected.value,
                            correct: item.correct
                        });
                    }
                } else {
                    wrongAnswers.push({
                        question: item.question,
                        selected: "未选择",
                        correct: item.correct
                    });
                }
            });

            const resultDiv = document.getElementById('result');
            if (resultDiv) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <h3>YD-
NNOVNCLD
-结果: ${score}/${total} 答案正确</h3>
                    <p>比例: ${(score/total * 100).toFixed(2)}%</p>
                `;
                if (wrongAnswers.length > 0) {
                    resultDiv.innerHTML += '<h4>错误答案:</h4>';
                    wrongAnswers.forEach((wrong, index) => {
                        resultDiv.innerHTML += `
                            <div class="wrong-answer">
                                Câu ${quizData.findIndex(q => q.question === wrong.question) + 1}: ${wrong.question}<br>
                                你的选择: ${wrong.selected} - 正确答案: ${wrong.correct}
                            </div>
                        `;
                    });
                } else {
                    resultDiv.innerHTML += '<p>回答正确所有问题</p>';
                }
                resultDiv.scrollIntoView({ behavior: 'smooth' });
                isSubmitted = true;
            }
        }

        // Xử lý chế độ hiển thị
        const contentModeButton = document.getElementById('contentMode');
        const quizModeButton = document.getElementById('quizMode');
        const vocabModeButton = document.getElementById('vocabMode');
        const contentContainer = document.getElementById('contentContainer');
        const quizContainer = document.getElementById('quizContainer');
        const vocabContainer = document.getElementById('vocabContainer');
        const vocabControls = document.getElementById('vocabControls');

        if (contentModeButton) {
            contentModeButton.addEventListener('click', () => {
                quizScrollPosition = window.scrollY;
                vocabScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'block';
                quizContainer.style.display = 'none';
                vocabContainer.style.display = 'none';
                vocabControls.style.display = 'none';
                contentModeButton.classList.add('active');
                quizModeButton.classList.remove('active');
                vocabModeButton.classList.remove('active');
                floatingControls.style.display = 'block';
                renderText();
                renderImage();
                window.scrollTo(0, contentScrollPosition);
            });
        }

        if (quizModeButton) {
            quizModeButton.addEventListener('click', () => {
                contentScrollPosition = window.scrollY;
                vocabScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'none';
                quizContainer.style.display = 'block';
                vocabContainer.style.display = 'none';
                vocabControls.style.display = 'none';
                quizModeButton.classList.add('active');
                contentModeButton.classList.remove('active');
                vocabModeButton.classList.remove('active');
                floatingControls.style.display = 'none';
                if (isSubmitted) {
                    userSelections = {};
                    isSubmitted = false;
                }
                loadQuiz();
            });
        }

        if (vocabModeButton) {
            vocabModeButton.addEventListener('click', () => {
                contentScrollPosition = window.scrollY;
                quizScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'none';
                quizContainer.style.display = 'none';
                vocabContainer.style.display = 'block';
                vocabControls.style.display = 'block';
                vocabModeButton.classList.add('active');
                contentModeButton.classList.remove('active');
                quizModeButton.classList.remove('active');
                floatingControls.style.display = 'none';
                initVocab();
                window.scrollTo(0, vocabScrollPosition);
            });
        }

        // Khởi tạo
        document.addEventListener('DOMContentLoaded', () => {
            renderText();
            renderImage();
            contentContainer.style.display = 'block';
            quizContainer.style.display = 'none';
            vocabContainer.style.display = 'none';
            vocabControls.style.display = 'none';
        });
    </script>
</body>
</html>
